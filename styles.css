:root {
  color-scheme: dark;
  font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}
* { box-sizing: border-box; }
body { margin: 0; background: linear-gradient(#a9d7ff, #d8efff 38%, #eff7ff); overflow: hidden; padding-bottom: env(safe-area-inset-bottom); }
#app { width: 100vw; height: 100dvh; min-height: 100vh; position: relative; padding-bottom: calc(env(safe-area-inset-bottom) + 6px); }
#gameCanvas { width: 100%; height: 100%; display: block; touch-action: none; }

#hud {
  position: absolute;
  top: calc(8px + env(safe-area-inset-top));
  left: 10px;
  display: grid;
  gap: 4px;
  font-size: 14px;
  font-weight: 700;
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
}
#controlBar {
  position: absolute;
  top: calc(8px + env(safe-area-inset-top));
  right: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.iconBtn, .dockBtn, .abilityBtn, .sideCamBtn {
  border: 1px solid rgba(145, 205, 255, 0.65);
  border-radius: 999px;
  background: rgba(8, 19, 31, 0.36);
  color: #f2fbff;
  backdrop-filter: blur(2px);
}
.iconBtn, .sideCamBtn { width: 40px; height: 40px; padding: 0; font-size: 18px; }
#speedLabel { font-weight: 800; font-size: 13px; min-width: 26px; text-shadow: 0 2px 4px rgba(0,0,0,.6); }
.sideCamBtn { position: absolute; top: 50%; right: 8px; transform: translateY(-50%); z-index: 6; }

#wavePreview {
  position: absolute;
  top: calc(126px + env(safe-area-inset-top));
  left: 10px;
  right: 10px;
  font-size: 12px;
  font-weight: 600;
  text-shadow: 0 2px 4px rgba(0,0,0,.65);
}
#bossWarning { position: absolute; left: 24%; right: 24%; top: calc(220px + env(safe-area-inset-top)); text-align: center; color: #ff879f; font-weight: 900; }

#abilityBar, #towerDock {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: min(92vw, 560px);
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 8px;
  overflow-x: auto;
  overflow-y: hidden;
  align-items: center;
  padding: 2px 0;
  scrollbar-width: thin;
}
#towerDock { bottom: calc(22px + env(safe-area-inset-bottom)); }
#abilityBar { bottom: calc(82px + env(safe-area-inset-bottom)); }
.dockBtn, .abilityBtn { width: 44px; height: 44px; min-width: 44px; padding: 0; font-size: 21px; display: grid; place-items: center; }
.dockBtn.active { outline: 2px solid #69ffbf; }
.dockBtn.locked, .abilityBtn.disabled { opacity: .45; }

#buildPanel, #selectionPanel {
  position: absolute; left: 8px; right: 8px; bottom: calc(116px + env(safe-area-inset-bottom));
  background: rgba(6, 15, 22, 0.6); border: 1px solid rgba(143, 198, 246, 0.42); border-radius: 10px; padding: 8px;
}
#buildPanel { display: flex; justify-content: space-between; align-items: center; }
#selectedName { margin: 4px 0; }
#selectedStats, #upgradeDiff { font-size: 14px; margin-bottom: 8px; }
.row { display: flex; gap: 8px; }
button { border: 1px solid #4d79a8; border-radius: 10px; background: #11243a; color: #e4f2ff; padding: 10px; font-size: 14px; font-weight: 700; }
.deltaUp { color: #7affbf; }
.deltaDown { color: #ff8fa8; }
.modal { position: absolute; inset: 0; background: rgba(1, 4, 8, 0.78); display: grid; place-items: center; z-index: 8; }
.sheet { width: min(92vw, 460px); max-height: 86vh; overflow: auto; background: #0f1a29; border: 1px solid rgba(106, 169, 240, 0.5); border-radius: 16px; padding: 16px; }
.settings { display: grid; gap: 8px; }
#metaTree { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 8px; margin-bottom: 12px; }
#toast { position: absolute; left: 50%; top: 48%; transform: translate(-50%, -50%); background: #154926; border: 1px solid #6ccf96; padding: 10px 14px; border-radius: 10px; opacity: 0; transition: opacity .2s; pointer-events: none; z-index: 12; }
#toast.show { opacity: 1; }
#updateBtn { position: absolute; left: 12px; right: 12px; top: calc(140px + env(safe-area-inset-top)); z-index: 20; }
.hidden { display: none !important; }

#waveInfo,
#wavePreview {
  display: none !important;
}

#topWaveCounter {
  font-size: 13px;
  font-weight: 800;
  color: #e8f6ff;
}

#nextWaveTimer {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  font-size: clamp(40px, 14vw, 86px);
  font-weight: 900;
  color: rgba(237, 248, 255, 0.52);
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.34);
  pointer-events: none;
  user-select: none;
  z-index: 5;
}

.phase { font-size: 12px; font-weight: 800; }
.phase.build { color: #b9ffd7; }
.phase.wave { color: #ffd0d9; }
#campaignWorldSelect { display:grid; grid-template-columns: 1fr; gap:6px; margin-bottom:8px; }
#campaignLevelSelect { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 8px; margin-bottom: 10px; }
.levelBtn.active { outline: 2px solid #7fd7ff; }
#unlockList { display: grid; gap: 6px; margin-bottom: 12px; font-size: 14px; }
#upgradePointsLabel { margin-bottom: 8px; color: #9bd4ff; font-weight: 700; }
#levelRewards { display: grid; gap: 8px; margin: 8px 0 14px; }

.builderSheet { width: min(94vw, 520px); max-height: 88vh; }
.builderModules { display: grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap: 8px; margin: 8px 0; }
.builderModuleBtn { border-radius: 12px; min-height: 62px; display:flex; flex-direction:column; align-items:flex-start; gap:2px; font-size:12px; }
.builderModuleBtn strong { font-size: 13px; }
.builderSlots { display: grid; grid-template-columns: repeat(5,minmax(0,1fr)); gap: 6px; margin-bottom: 10px; }
.builderSlot { min-height: 46px; border: 1px dashed #6ba9dd; border-radius: 10px; display:grid; place-items:center; background: rgba(18,33,51,.45); font-size: 19px; }
.builderSlot.filled { border-style: solid; }
.builderPreview { font-size: 13px; line-height: 1.45; margin-bottom: 10px; background: rgba(8,16,26,.6); border:1px solid rgba(106,169,240,.35); border-radius:10px; padding:8px; }
.savedBuilds { display:grid; grid-template-columns: repeat(1,minmax(0,1fr)); gap: 6px; margin-bottom: 10px; }
.savedBuildRow { display:flex; justify-content:space-between; gap:8px; align-items:center; font-size:12px; border:1px solid rgba(122,174,220,.35); border-radius:10px; padding:7px; }
.savedBuildRow button { padding: 6px 8px; font-size: 12px; }
.tiny { opacity: .82; font-size: 12px; margin-top: -2px; }
@media (max-width: 420px) {
  #controlBar { top: calc(8px + env(safe-area-inset-top)); }
  #wavePreview { top: calc(118px + env(safe-area-inset-top)); }
  #abilityBar { bottom: calc(82px + env(safe-area-inset-bottom)); }
  #towerDock { bottom: calc(22px + env(safe-area-inset-bottom)); }
  #bossWarning { top: calc(214px + env(safe-area-inset-top)); }
  .builderModules { grid-template-columns: repeat(2,minmax(0,1fr)); }
}

#obstaclePanel {
  position: absolute; left: 8px; right: 8px; bottom: calc(170px + env(safe-area-inset-bottom));
  background: rgba(18, 15, 12, 0.78); border: 1px solid rgba(236, 170, 120, 0.6); border-radius: 10px; padding: 8px;
  display: flex; justify-content: space-between; align-items: center; z-index: 7;
}
#clearObstacleBtn { padding: 8px 10px; border-radius: 9px; }
